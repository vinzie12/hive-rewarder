# hive-rewarder

Delegator dashboard and reward accumulator for **@bayanihive**, showing daily rewards, applied multipliers, accumulated balances, and SBI payouts.

---

## Purpose

- Reads daily base rewards generated by Hive Vote Tool (`payout_summary.json`).
- Applies a **global multiplier** based on total delegation of @bayanihive:
  - Total delegation **< 10,000 HP** → multiplier = **x3**
  - Total delegation **≥ 10,000 HP** → multiplier = **x1**
- Accumulates individual delegator balances.
- Automatically sends **1 HIVE chunks** to [SBI (@steembasicincome)](https://peakd.com/@steembasicincome) when a delegator's balance ≥ 1.
- Tracks remaining balance for each delegator.
- Generates logs for full transparency.
- Provides a **read-only dashboard** for delegators to view their daily and accumulated rewards.

---

## Project Structure

```
hive-rewarder/
├── README.md
├── package.json
├── .gitignore
├── scripts/
│   ├── accumulator.js        # Core accumulation logic
│   ├── fetch_rewards.js      # Reads/validates payout_summary.json
│   ├── send_sbi.js           # Sends HIVE to SBI (supports dry-run)
│   └── utils.js              # Helper functions
├── data/
│   ├── delegator_balances.json   # Current balances & total sent
│   ├── sbi_log.json              # History of SBI transactions
│   └── payout_summary.json      # Input from Hive Vote Tool
├── dashboard/
│   ├── index.html            # Delegator-facing UI
│   ├── app.js                # Frontend JS
│   ├── style.css             # Dark-themed style
│   └── assets/               # Icons, images (optional)
└── .github/
    └── workflows/
        └── daily_accumulator.yml  # GitHub Actions daily workflow
```

---

## Quick Start

### 1. Clone the repository

```bash
git clone https://github.com/YOUR_USERNAME/hive-rewarder.git
cd hive-rewarder
```

### 2. Install dependencies

```bash
npm install
```

### 3. Run scripts locally

```bash
# Validate payout summary
node scripts/fetch_rewards.js

# Run full accumulation (dry-run mode)
DRY_RUN=true node scripts/accumulator.js

# Or run send_sbi.js independently
DRY_RUN=true node scripts/send_sbi.js
```

### 4. View the dashboard

Open `dashboard/index.html` in your browser. It reads JSON files from `data/` directly — no backend needed.

---

## Viewing the Dashboard on GitHub Pages

1. Go to your repo **Settings → Pages**.
2. Set the source to **Deploy from a branch** → select `main` branch, `/ (root)` folder.
3. Your dashboard will be available at:
   ```
   https://YOUR_USERNAME.github.io/hive-rewarder/dashboard/
   ```
4. The dashboard reads the JSON files committed to `data/` and updates automatically after each GitHub Actions run.

---

## Dry-Run Mode

All scripts support a **dry-run mode** that simulates SBI transfers without broadcasting real transactions on the Hive blockchain.

To enable dry-run mode, set the environment variable:

```bash
DRY_RUN=true node scripts/accumulator.js
```

In dry-run mode:
- Balances are still calculated and accumulated.
- SBI send operations are logged but **not** actually broadcast.
- JSON files are still updated locally for testing.

---

## GitHub Actions Workflow

The `daily_accumulator.yml` workflow runs automatically every day at **1:00 AM UTC**:

1. Runs `fetch_rewards.js` to validate payout data.
2. Runs `accumulator.js` to apply multipliers and accumulate balances.
3. Sends SBI payouts via `send_sbi.js` when balances reach ≥ 1 HIVE.
4. Commits updated JSON files back to the repository.

### Required Secrets

| Secret      | Description                             |
|-------------|-----------------------------------------|
| `HIVE_USER` | Hive account name (e.g., `bayanihive`)  |
| `HIVE_KEY`  | Active key for the Hive account         |
| `DRY_RUN`   | Set to `true` to disable real transfers |

---

## License

MIT
